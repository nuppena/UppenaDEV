sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/BusyIndicator","sap/m/MessageBox"],(e,t,a)=>{"use strict";return e.extend("pcf.com.acc.packaging.controller.Packaging",{onInit(){var e=new sap.ui.model.json.JSONModel;this.getView().setModel(e,"excelData");this.PackagingState=this.getOwnerComponent().getState("Packaging");this.PackagingService=this.getOwnerComponent().getService("Packaging")},onSaveChanges:function(){const e=this.getView().getModel("excelData");if(!e||!e.getData().results||e.getData().results.length===0){a.warning("No data available to save.");return}const t=e.getData().results;const o=XLSX.utils.json_to_sheet(t);const n=XLSX.utils.book_new();XLSX.utils.book_append_sheet(n,o,"Updated Data");XLSX.writeFile(n,"Updated_PackagingData.xlsx");a.success("Changes saved successfully!")},onDownloadTemplate:function(){var e="PackagingTemplate.xlsx";var t=`./DownloadTemplate/${e}`;const a=document.createElement("a");a.href=t;a.style.display="none";document.body.appendChild(a);a.click();document.body.removeChild(a)},onExecute:function(){const e=this;return e._uploadFileExecute()},_getFileUploader:function(){return this.getView().byId("fileUploaderDialog")},_uploadFileExecute:function(){const e=this;t.show(0);return new Promise(async function(t,a){const o=e._getFileUploader();const n=o.oFileUpload.files[0];const i=n.name;sap.ui.getCore().fileUploadArr=[];const s=n.type;let l=await e._base64conversionMethod(s,i,n);if(l){let t={payload:[{data:l}]};e._sendPayload(t)}})},_base64conversionMethod:async function(e,t,a,o){return new Promise((n,i)=>{const s=this;if(!FileReader.prototype.readAsBinaryString){FileReader.prototype.readAsBinaryString=function(a){const n="";const i=new FileReader;i.onload=async function(a){const l=new Uint8Array(i.result);const r=l.byteLength;for(const e=0;e<r;e++){n+=String.fromCharCode(l[e])}s.base64ConversionRes=await btoa(n);sap.ui.getCore().fileUploadArr.push({DocumentType:o,MimeType:e,FileName:t,Content:s.base64ConversionRes})};i.readAsArrayBuffer(a)}}const l=new FileReader;l.onload=async function(a){const i=a.target.result;s.base64ConversionRes=await btoa(i);await sap.ui.getCore().fileUploadArr.push({DocumentType:o,MimeType:e,FileName:t,Content:s.base64ConversionRes});let l=(new sap.ui.getCore).fileUploadArr[0].Content;n(l)};l.readAsBinaryString(a)})},_chkFile:function(){const e=this.getView().getModel("i18n").getResourceBundle();const t=this._getFileUploader().oFileUpload.files[0];return new Promise(function(o,n){if(typeof t===UIConstants.undefined){a.error(e.getText("fileValidation"));return n()}else if(plantCd.length===0){a.error(e.getText("mandatoryChck"))}else{o()}})},_sendPayload:async function(e){const o=this;const n=o.getView().getModel("i18n").getResourceBundle();t.show(0);return await this.PackagingService.uploadData(e).then(function(e){t.hide();if(e.data){}else{a.error(n.getText("errorMsg"),{onClose:function(){}})}}.bind(this),function(e){t.hide();const o=JSON.parse(e.responseText).error.message.value;a.error(o,{onClose:function(){}})}.bind(this))},onImportExcel:function(){this.byId("fuV1000FileUploaderId").$().find("input")[0].click()},onFileSelected:function(e){var t=e.getParameter("files")[0];if(t){var o=new FileReader;o.onload=function(e){var t=e.target.result;var o=XLSX.read(t,{type:"binary"});var n=o.SheetNames[0];var i=o.Sheets[n];var s=XLSX.utils.sheet_to_json(i);if(!s||s.length===0){a.error("Please fill all the mandatory fields.");return}var l=["Site ID","Country Name","Material ID","Material Name","Short Description"];var r=s.every(e=>l.every(t=>e[t]&&e[t].toString().trim()!==""));if(!r){a.error("Please fill all the mandatory fields.");return}var c=new sap.ui.model.json.JSONModel;c.setData({results:s});console.log("Parsed Excel Data:",s)}.bind(this);o.readAsBinaryString(t)}},onFileSelected:function(e){const t=e.getParameter("files")[0];if(t){this._selectedFile=t}},onUploadFile:function(){if(!this._selectedFile){sap.m.MessageToast.show("Please select a file first.");return}const e=["Site ID","Country Name","Material ID","Material Name","Short Description"];const t=this;var o=new FileReader;o.onload=function(o){var n=o.target.result;var i=XLSX.read(n,{type:"binary"});var s=i.SheetNames[0];var l=i.Sheets[s];var r=XLSX.utils.sheet_to_json(l,{defval:""});if(!r||r.length===0){a.error("Please fill all the mandatory fields.");t.getView().getModel("excelData").setData({results:[]});return}let c=[];r.forEach((t,a)=>{let o=e.every(e=>t[e]&&t[e].toString().trim()!=="");if(!o){c.push(a+2)}});if(c.length>0){a.error("Please fill all the mandatory fields.\nMissing fields Row Numbers: "+c.join(", "));t.getView().getModel("excelData").setData({results:[]});return}var d=new sap.ui.model.json.JSONModel;d.setData({results:r});t.getView().setModel(d,"excelData");a.success("File uploaded and validated successfully.");if(t._oUploadDialog){t._oUploadDialog.close()}};o.readAsBinaryString(this._selectedFile)},onOpenUploadDialog:function(){const e=this.getView().byId("fileUploaderDialog");if(e){e.clear();this._selectedFile=""}if(!this._oUploadDialog){this._oUploadDialog=new sap.m.Dialog({title:"Upload Excel File",contentWidth:"400px",content:[new sap.ui.unified.FileUploader({id:this.createId("fileUploaderDialog"),name:"upload",fileType:["xlsx","csv"],change:this.onFileSelected.bind(this)})],beginButton:new sap.m.Button({text:"Upload",press:this.onUploadFile.bind(this)}),endButton:new sap.m.Button({text:"Close",press:function(){this._oUploadDialog.close()}.bind(this)})})}this._oUploadDialog.open()},onExport:function(){const e=this.getView().getModel("excelData");if(!e||!e.getData().results||e.getData().results.length===0){sap.m.MessageBox.warning("No data available to export.");return}const t=e.getData().results;const a=XLSX.utils.json_to_sheet(t);const o=XLSX.utils.book_new();XLSX.utils.book_append_sheet(o,a,"Exported Data");XLSX.writeFile(o,"PackagingEFData.xlsx")},onFilter:function(){var e=this._getSmartTable();if(e){e.openPersonalisationDialog("Filter")}},_getSmartTable:function(){if(!this._oSmartTable){this._oSmartTable=this.getView().byId("smartTable")}return this._oSmartTable}})});
//# sourceMappingURL=Packaging.controller.js.map